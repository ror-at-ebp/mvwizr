<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Berechnete Mischproben • mvwizr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Berechnete Mischproben">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mvwizr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mvwizr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/berechnete-mischproben.html">Berechnete Mischproben</a></li>
    <li><a class="dropdown-item" href="../articles/datei-spezifikationen.html">Dateispezifikationen für mvwizr</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Berechnete Mischproben</h1>
            
      

      <div class="d-none name"><code>berechnete-mischproben.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ror-at-ebp.github.io/mvwizr/">mvwizr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; mvwizr geladen: v1.2.0</span></span></code></pre></div>
<div class="section level2">
<h2 id="einleitung">Einleitung<a class="anchor" aria-label="anchor" href="#einleitung"></a>
</h2>
<p>mvwizr unterscheidet grundsätzlich zwischen zwei verschiedenen
Probearten: Stichproben und Mischproben oder Sammelproben (mvwizr macht
keine Unterscheidung zwischen zeit- und abflussproportionalen
Mischproben). Bei den Sammelproben gibt es einerseits kurze Proben mit
einer Dauer von 3.5-Tagen, die gut geeignet sind um akute Belastungen zu
bewerten und zu finden und andererseits Zweiwochenmischproben (14-Tage),
die für die Beurteilung anhaltender Belastungen relevant sind. Teilweise
werden am gleichen Standort sowohl (phasenweise) 3.5-Tage-Mischproben
und 14-Tagemischproben genommen. In einigen Fällen wird im Anschluss aus
3.5-Tage-Mischproben rechnerisch eine 14-Tage-Mischprobe erstellt, eine
sogenannte <strong>berechnete</strong> Mischprobe.</p>
<p>mvwizr kann automatisch 3.5-Tage-Mischproben, die für die Berechnung
von berechneten 14-Tage-Mischproben verwendet wurden, aus dem Datensatz
entfernen. So wird sichergestellt, dass jede Probe nur einmal
gezählt/bewertet wird. Damit dies klappt, benötigt mvwizr eine Angabe
über die Art der Mischprobe: Intern verwendet das Paket die
Bezeichnungen <code>SaP</code> für tatsächliche Mischproben und
<code>bSaP</code> für berechnete Mischproben (angelehnt an die
Nomenklatur des GBL). Unglücklicherweise ist im NAWA-MV-Format des BAFU
kein solches Attribut definiert, resp. es wird nur zwischen Stichproben
(mvwizr-intern <code>S</code>) und Mischproben unterschieden.</p>
<p>Auch müssen diese zur Berechnung verwendeten 3.5-Tage-Mischproben
innerhalb des Intervalls der berechneten 14-Tage-Mischprobe liegen.
Falls die 3.5-Tage-Proben verschoben sind, so werden diese nicht korrekt
erkannt und entfernt!</p>
</div>
<div class="section level2">
<h2 id="bsap-daten-verarbeiten---beispiel">bSaP-Daten verarbeiten - Beispiel<a class="anchor" aria-label="anchor" href="#bsap-daten-verarbeiten---beispiel"></a>
</h2>
<p>Das folgende Beispiel soll aufzeigen, wie im Fall von NAWA-MV-Daten
dennoch konsistente Datensätze mit bSaP-Messungen eingelesen werden
können.</p>
<ol style="list-style-type: decimal">
<li>Wichtig ist dabei, dass berechnete Mischproben und gemessene
Mischproben (und ggf. Stichproben) in (zwei) unterschiedlichen Dateien
vorliegen und im gleichen Vorgang mit <code><a href="../reference/batch_einlesen_nawa.html">batch_einlesen_nawa()</a></code>
eingelesen werden (damit die UID-Nummerierung stimmt). Beispiel:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mv_bsap_pfade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"NAWA_ohne_bSaP_Bsp.xlsx"</span>,</span>
<span>  <span class="st">"NAWA_mit_bSaP_Bsp.csv"</span></span>
<span><span class="op">)</span>, package <span class="op">=</span> <span class="st">"mvwizr"</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Im nächsten Schritt muss nun manuell das “bSaP”-Attribut den Daten
hinzugefügt werden (dort wo es sich um berechente Mischproben handelt).
Da diese hier in einer separaten Datei vorlagen und der Dateiname im
Dataframe enthalten ist, kann das Attribut ganz leicht korrekt gesetzt
werden. Die Warnungen, die <code><a href="../reference/batch_einlesen_nawa.html">batch_einlesen_nawa()</a></code> dabei
zeigt, sollten aufmerksam gelesen werden - oft handelt es sich um Fälle
von fehlenden Zuordnungen von Substanzen zur VSA-ID oder sonstigen
Fehlern, die sich manuell beheben lassen.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mv_df_alle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_einlesen_nawa.html">batch_einlesen_nawa</a></span><span class="op">(</span><span class="va">mv_bsap_pfade</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Wir setzen bSaP nur dort, wo die Daten aus der Datei mit den berechneten Mischproben stammen</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>PROBEARTID <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">filename</span> <span class="op">==</span></span>
<span>    <span class="st">"NAWA_mit_bSaP_Bsp.csv"</span>, <span class="st">"bSaP"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">PROBEARTID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Keine Import-Manifest-Datei angegeben. Lese Dateien ein und errate Funktionsparameter...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">(1/2)  Lese NAWA_ohne_bSaP_Bsp.xlsx ...</span> <span style="color: #00BBBB;">─────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> VSA-Lookup: 2 mehrfache Bezeichnungen (VSA Parameter-ID) pro Substanz_ID</span></span>
<span><span class="co">#&gt;   gefunden. Verwende tiefere Substanz_ID.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Betroffen: 8_2-FTCA, SiO2</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Lese MV-Daten von Excel-Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_ohne_bSaP_Bsp.xlsx ein.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Versuche Start des Tabellen-Headers der Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_ohne_bSaP_Bsp.xlsx zu erraten.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Erkannter Header-Start: Zeile 8.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Versuche Sprache der Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_ohne_bSaP_Bsp.xlsx zu erraten.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Erkannte Sprache: DE.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Versuche Parameter-Feld der Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_ohne_bSaP_Bsp.xlsx zu erraten.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Erkannter Parameter: BAFU_Parameter_ID.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Bestimmungsgrenzen wurden nicht als Zahlen eingelesen - versuche Typenkonvertierung.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Normalisiere Einheiten der MV-Daten auf µg/l.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Max./min. Bestimmungsgrenzen der MV-Daten bestimmen...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">(2/2)  Lese NAWA_mit_bSaP_Bsp.csv ...</span> <span style="color: #00BBBB;">───────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> VSA-Lookup: 2 mehrfache Bezeichnungen (VSA Parameter-ID) pro Substanz_ID</span></span>
<span><span class="co">#&gt;   gefunden. Verwende tiefere Substanz_ID.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Betroffen: 8_2-FTCA, SiO2</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Lese MV-Daten von Text-Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_mit_bSaP_Bsp.csv ein.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Versuche Encoding der Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_mit_bSaP_Bsp.csv zu erraten.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Erkanntes Encoding: UTF-8</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Versuche Trennzeichen der Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_mit_bSaP_Bsp.csv zu erraten.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Erkanntes Trennzeichen: ;</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Versuche Start des Tabellen-Headers der Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_mit_bSaP_Bsp.csv zu erraten.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Erkannter Header-Start: Zeile 1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Versuche Sprache der Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_mit_bSaP_Bsp.csv zu erraten.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Erkannte Sprache: DE.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Lese NAWA-MV-Daten von /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_mit_bSaP_Bsp.csv ein.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Versuche Parameter-Feld der Datei /home/runner/work/_temp/Library/mvwizr/extdata/NAWA_mit_bSaP_Bsp.csv zu erraten.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Erkannter Parameter: BAFU_Parameter_ID.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Normalisiere Einheiten der MV-Daten auf µg/l.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Max./min. Bestimmungsgrenzen der MV-Daten bestimmen...</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Kombiniere MV-Daten aus 2 Dateien...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> MV-Daten erfolgreich eingelesen und kombiniert.</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Im nächsten Schritt können die bSaP-Proben nun korrekt prozessiert
werden:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mv_mit_bsap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prozessiere_bSaP.html">prozessiere_bSaP</a></span><span class="op">(</span><span class="va">mv_df_alle</span>, bSaP_identifier <span class="op">=</span> <span class="st">"PROBEARTID"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Dauer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">ENDEPROBENAHME</span>,</span>
<span>    <span class="va">.data</span><span class="op">$</span><span class="va">BEGINNPROBENAHME</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"days"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mv_mit_bsap</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 59</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Alternativ können alle berechneten Proben über das Attribut auch
herausgefiltert werden, wenn man alle 3.5-Tage-Proben im Dataframe
behalten will:</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mv_ohne_bsap</span> <span class="op">&lt;-</span> <span class="va">mv_df_alle</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">PROBEARTID</span> <span class="op">!=</span> <span class="st">"bSaP"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mv_ohne_bsap</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 131</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mv-daten-im-vergleich">MV-Daten im Vergleich<a class="anchor" aria-label="anchor" href="#mv-daten-im-vergleich"></a>
</h2>
<p>Der Vorteil dieses Vorgehens ist, dass die Datensätze nun einfach
verglichen werden können:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_misch_verlauf.html">plot_misch_verlauf</a></span><span class="op">(</span><span class="va">mv_ohne_bsap</span>, stationscode <span class="op">=</span> <span class="st">"101099"</span><span class="op">)</span></span></code></pre></div>
<p><img src="berechnete-mischproben_files/figure-html/unnamed-chunk-6-1.png" width="700">
Es ist klar sichtbar, dass die Konzentrationsspitzen im Datensatz mit
den berechneten Mischproben stark rausgeglättet worden sind:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_misch_verlauf.html">plot_misch_verlauf</a></span><span class="op">(</span><span class="va">mv_mit_bsap</span>, stationscode <span class="op">=</span> <span class="st">"101099"</span><span class="op">)</span></span></code></pre></div>
<p><img src="berechnete-mischproben_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Remo Röthlin, Kanton Bern, AWA.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
